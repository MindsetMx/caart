<h1 class="font-optima text-4xl font-bold">Información general</h1>

<form id="generalInformationForm" [formGroup]="generalInformationForm" (ngSubmit)="generalInformationFormSubmit()"
  class="space-y-6">
  <div>
    <label for="taxId" class="block mb-1 text-sm">RFC</label>
    <input formControlName="taxId" id="taxId" class="max-w-lg" type="text" placeholder="Escribe tu RFC" sharedInput>
    @if (hasError(generalInformationForm, 'taxId')) {
    <shared-input-error [message]="getError(generalInformationForm, 'taxId')"></shared-input-error>
    }
  </div>

  <div>
    <h2 class="text-xl font-bold mb-5">Elige tu paquete de subastas</h2>
    <fieldset>
      <legend class="sr-only">Paquete de subastas</legend>
      <div class="space-y-6">
        @for (type of auctionTypes().data; track $index) {
        <div class="flex">
          <input formControlName="auctionTypeId" [id]="$index" [value]="type.id" type="radio" class="h-6 w-6">
          <label [for]="$index" class="ml-3 block leading-6">
            <p class="font-bold">
              {{type.attributes.amount | currency:'USD':'symbol':'1.2-2'}} MXN
            </p>
            <p>{{type.attributes.description}}</p>
            <span class="text-red-500">
              {{type.attributes.submessage}}
            </span>
          </label>
        </div>
        }
      </div>
    </fieldset>

    @if(hasError(generalInformationForm, 'auctionTypeId')) {
    <shared-input-error [message]="getError(generalInformationForm, 'auctionTypeId')"></shared-input-error>
    }
  </div>

  <div>
    <h2 class="text-xl font-bold mb-5">Método de pago</h2>

    <fieldset>
      <legend class="sr-only">Método de pago</legend>
      <div class="space-y-6">
        @for (paymentMethod of paymentMethods(); track $index) {
        <div class="flex items-center">
          <input formControlName="paymentMethodId" [id]="$index" [value]="paymentMethod.id" type="radio"
            class="h-6 w-6">
          <label [for]="$index" class="ml-3 block leading-6">
            @switch (paymentMethod.card.brand) {
            @case ('visa') {
            <img src="assets/img/icons/visa.svg" alt="Visa">
            }
            }

            <p class="font-bold mt-2">
              <span>{{paymentMethod.card.brand | titlecase}}</span> que termina en {{paymentMethod.card.last4}}
            </p>
            <p>Expira el {{paymentMethod.card.expMonth}}/{{paymentMethod.card.expYear}}</p>
          </label>
        </div>
        }
      </div>
    </fieldset>
  </div>
</form>

<div>
  <button (click)="addPaymentMethod.set(!addPaymentMethod())" type="button" class="block ml-auto" width="w-fit"
    sharedTertiaryButton>
    Agregar nuevo
  </button>
</div>

@if (addPaymentMethod() && addPaymentMethodForm) {
<form [formGroup]="addPaymentMethodForm" (ngSubmit)="addPaymentMethodFormSubmit()">
  @if (paymentMethods().length === 0 || addPaymentMethod()) {
  <div>
    <h2 class="text-xl font-bold mb-5">Añade tus datos bancarios</h2>

    <div class="mb-6">
      <label for="cardholderName" class="block mb-1 text-sm">Nombre del titular</label>
      <input formControlName="cardholderName" id="cardholderName" class="max-w-lg" type="text"
        placeholder="Escribe el nombre del titular" sharedInput>
      @if (hasError(addPaymentMethodForm, 'cardholderName')) {
      <shared-input-error [message]="getError(addPaymentMethodForm, 'cardholderName')"></shared-input-error>
      }
    </div>

    <ngx-stripe-elements [stripe]="stripe" [elementsOptions]="elementsOptions">
      <ngx-stripe-card [options]="cardOptions" />
    </ngx-stripe-elements>

    @if(hasError(generalInformationForm, 'paymentMethodId')) {
    <shared-input-error [message]="getError(generalInformationForm, 'paymentMethodId')"></shared-input-error>
    }
  </div>

  <div class="mt-6">
    <button class="block ml-auto" width="w-fit" [disabled]="isButtonSubmitDisabled2()"
      [class.opacity-50]="isButtonSubmitDisabled2()" sharedTertiaryButton>
      @if (isButtonSubmitDisabled2()) {
      <shared-spinner></shared-spinner>
      } @else {
      Agregar método de pago
      }
    </button>
  </div>
  }
</form>
}

<button form="generalInformationForm" class="mt-8" type="submit" [disabled]="isButtonSubmitDisabled()"
  [class.opacity-50]="isButtonSubmitDisabled()" sharedPrimaryButton>
  @if (isButtonSubmitDisabled()) {
  <shared-spinner></shared-spinner>
  } @else {
  Pagar y continuar
  }
</button>